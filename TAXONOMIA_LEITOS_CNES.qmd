---
title: "Taxonomia Hier√°rquica de Leitos Hospitalares do CNES"
subtitle: "Metodologia Determin√≠stica por Regras de Neg√≥cio"
author: "Cieges - Brasil Estadual"
date: "2026-01-21"
format:
  html:
    theme: cosmo
    toc: true
    toc-depth: 4
    toc-location: left
    number-sections: true
    code-fold: true
    code-summary: "Ver c√≥digo"
    df-print: paged
  pdf:
    toc: true
    toc-depth: 4
    number-sections: true
    documentclass: article
    papersize: a3
    geometry:
      - margin=1.5cm
    include-in-header:
      text: |
        \usepackage{fvextra}
        \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
        \DefineVerbatimEnvironment{OutputCode}{Verbatim}{breaklines,commandchars=\\\{\}}
        \usepackage{geometry}
        \geometry{a3paper, margin=1.5cm}
        \usepackage{pdflscape}
        \usepackage{longtable}
        \usepackage{array}
        \usepackage{multirow}
        \usepackage{wrapfig}
        \usepackage{float}
        \floatplacement{figure}{H}
        \setlength{\parindent}{0pt}
        \setlength{\parskip}{4pt}
        \usepackage{adjustbox}
        \usepackage{tabularx}
        \usepackage{booktabs}
    colorlinks: true
execute:
  echo: true
  warning: false
  message: false
---

# Introdu√ß√£o

## Objetivo

Este documento apresenta uma **taxonomia hier√°rquica de leitos hospitalares** baseada em regras de neg√≥cio determin√≠sticas, com fundamenta√ß√£o normativa e cl√≠nica. A taxonomia classifica os 535.133 leitos do CNES (compet√™ncia 202506) em uma estrutura de **tr√™s n√≠veis hier√°rquicos**.

## Fundamenta√ß√£o Normativa

A classifica√ß√£o proposta est√° fundamentada nas seguintes normativas do Minist√©rio da Sa√∫de e ANVISA:

| Normativa | Descri√ß√£o | Aplica√ß√£o |
|-----------|-----------|-----------|
| **RDC ANVISA n¬∫ 7/2010** | Requisitos m√≠nimos para UTI | Classifica√ß√£o de leitos intensivos (Tipo I, II, III) |
| **Portaria GM/MS n¬∫ 3.432/1998** | Crit√©rios de classifica√ß√£o hospitalar | N√≠veis de complexidade |
| **Portaria GM/MS n¬∫ 930/2012** | Diretrizes para aten√ß√£o neonatal | UCI e UTI neonatal |
| **Portaria GM/MS n¬∫ 148/2012** | CAPS e Sa√∫de Mental | Leitos de sa√∫de mental |
| **Portaria GM/MS n¬∫ 2.809/2012** | Hospitais de Longa Perman√™ncia | Leitos de cr√¥nicos |

## Estrutura da Taxonomia

```
N√çVEL 1: INTENSIDADE DO CUIDADO (5 categorias)
‚îÇ
‚îú‚îÄ‚îÄ N√çVEL 2: P√öBLICO-ALVO (4 categorias)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ N√çVEL 3: GRUPO DE ESPECIALIDADE (18 grupos)
‚îÇ       ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ ESPECIALIDADE ORIGINAL (65 c√≥digos CNES)
```

# Metodologia

## N√≠vel 1: Intensidade do Cuidado

Classifica√ß√£o baseada na **densidade tecnol√≥gica** e **complexidade assistencial** do leito.

### Defini√ß√µes Operacionais

| C√≥digo | Categoria | Defini√ß√£o | Crit√©rio de Inclus√£o |
|--------|-----------|-----------|----------------------|
| **N1_01** | INTENSIVO | Leitos com monitoriza√ß√£o cont√≠nua, suporte avan√ßado de vida e alta densidade tecnol√≥gica | UTI (todos os tipos), UCO, UTI Queimados |
| **N1_02** | SEMI-INTENSIVO | Leitos com monitoriza√ß√£o intermitente e suporte intermedi√°rio | UCI Adulto/Pedi√°trico/Neonatal, Canguru, Suporte Ventilat√≥rio |
| **N1_03** | ALTA_COMPLEXIDADE | Leitos para procedimentos de alta complexidade ou condi√ß√µes especiais | Transplante, Queimados (n√£o UTI), Oncologia cir√∫rgica |
| **N1_04** | MEDIA_COMPLEXIDADE | Leitos cir√∫rgicos e cl√≠nicos de m√©dia complexidade | Cirurgias eletivas, interna√ß√µes cl√≠nicas agudas |
| **N1_05** | BAIXA_COMPLEXIDADE | Leitos de longa perman√™ncia, reabilita√ß√£o e cuidados prolongados | Cr√¥nicos, Psiquiatria, Reabilita√ß√£o, Hospital Dia |

### Matriz de Classifica√ß√£o - N√≠vel 1

```{python}
import pandas as pd
import numpy as np
import warnings
warnings.filterwarnings('ignore')

# Carregar dados
df = pd.read_csv('arq2_tratado.csv', sep=';', encoding='latin1', low_memory=False)

# =============================================================================
# N√çVEL 1: INTENSIDADE DO CUIDADO
# =============================================================================

def classificar_intensidade(row):
    """
    Classifica o leito quanto √† intensidade do cuidado.
    
    Fundamenta√ß√£o:
    - RDC ANVISA n¬∫ 7/2010: UTI Tipo I, II, III
    - Portaria GM/MS n¬∫ 930/2012: UCI Neonatal
    - Portaria GM/MS n¬∫ 2.809/2012: Longa Perman√™ncia
    """
    co = row['co_leito']
    tp = row['tp_leito']
    ds = str(row['DS_CO_LEITO']).upper()
    
    # ---------------------------------------------------------------------
    # N1_01: INTENSIVO
    # UTI Adulto, Pedi√°trica, Neonatal, Coronariana, Queimados
    # ---------------------------------------------------------------------
    LEITOS_UTI = [74, 75, 76,  # UTI Adulto Tipo I, II, III
                  77, 78, 79,  # UTI Pedi√°trica Tipo I, II, III
                  80, 81, 82,  # UTI Neonatal Tipo I, II, III
                  83,          # UTI de Queimados
                  85, 86]      # UTI Coronariana Tipo II, III
    
    if co in LEITOS_UTI:
        return 'N1_01_INTENSIVO'
    
    # ---------------------------------------------------------------------
    # N1_02: SEMI-INTENSIVO
    # UCI (Unidade de Cuidados Intermedi√°rios), Canguru, Suporte Ventilat√≥rio
    # ---------------------------------------------------------------------
    LEITOS_UCI = [65,          # Unidade Intermedi√°ria Neonatal
                  92,          # UCI Neonatal Convencional
                  93,          # UCI Neonatal Canguru
                  94,          # UCI Pedi√°trico
                  95,          # UCI Adulto
                  96]          # Suporte Ventilat√≥rio Pulmonar
    
    if co in LEITOS_UCI:
        return 'N1_02_SEMI_INTENSIVO'
    
    # ---------------------------------------------------------------------
    # N1_03: ALTA COMPLEXIDADE
    # Transplante, Queimados (n√£o UTI), Oncologia, Cardiologia cir√∫rgica
    # ---------------------------------------------------------------------
    LEITOS_ALTA = [67,         # Transplante
                   71,         # Intercorr√™ncia p√≥s-transplante
                   90, 91,     # Queimado Adulto/Pedi√°trico (cir√∫rgico)
                   88, 89]     # Queimado Adulto/Pedi√°trico (cl√≠nico)
    
    # Oncologia e Cardiologia cir√∫rgica
    if co in LEITOS_ALTA:
        return 'N1_03_ALTA_COMPLEXIDADE'
    
    if tp == 1 and co in [2, 12]:  # Cardiologia e Oncologia cir√∫rgica
        return 'N1_03_ALTA_COMPLEXIDADE'
    
    # ---------------------------------------------------------------------
    # N1_05: BAIXA COMPLEXIDADE (verificar antes de m√©dia)
    # Cr√¥nicos, Psiquiatria, Reabilita√ß√£o, Hospital Dia, Sa√∫de Mental
    # ---------------------------------------------------------------------
    LEITOS_BAIXA = [34,        # Cr√¥nicos
                    47,        # Psiquiatria
                    48,        # Reabilita√ß√£o
                    49,        # Pneumologia Sanit√°ria (tuberculose)
                    84,        # Acolhimento Noturno
                    87,        # Sa√∫de Mental (cl√≠nico)
                    73]        # Sa√∫de Mental (hospital dia)
    
    if co in LEITOS_BAIXA:
        return 'N1_05_BAIXA_COMPLEXIDADE'
    
    # Hospital Dia (exceto cir√∫rgico/diagn√≥stico)
    if tp == 7 and co != 7:
        return 'N1_05_BAIXA_COMPLEXIDADE'
    
    # ---------------------------------------------------------------------
    # N1_04: M√âDIA COMPLEXIDADE (default)
    # Cir√∫rgico, Cl√≠nico agudo, Obst√©trico, Pedi√°trico
    # ---------------------------------------------------------------------
    return 'N1_04_MEDIA_COMPLEXIDADE'

df['NIVEL_1_INTENSIDADE'] = df.apply(classificar_intensidade, axis=1)

# Resumo N√≠vel 1
n1_resumo = df.groupby('NIVEL_1_INTENSIDADE').agg({
    'cnes': 'count',
    'qt_exist': 'sum'
}).rename(columns={'cnes': 'Registros', 'qt_exist': 'Leitos'})
n1_resumo['%'] = (n1_resumo['Leitos'] / n1_resumo['Leitos'].sum() * 100).round(2)
n1_resumo = n1_resumo.sort_values('Leitos', ascending=False)

print("N√çVEL 1: INTENSIDADE DO CUIDADO")
print("="*60)
n1_resumo
```

## N√≠vel 2: P√∫blico-Alvo

Classifica√ß√£o baseada na **faixa et√°ria e condi√ß√£o** do paciente atendido.

### Defini√ß√µes Operacionais

| C√≥digo | Categoria | Defini√ß√£o | Crit√©rio de Inclus√£o |
|--------|-----------|-----------|----------------------|
| **N2_01** | ADULTO | Pacientes com idade ‚â• 15 anos (exceto gestantes) | Leitos sem especifica√ß√£o pedi√°trica, neonatal ou obst√©trica |
| **N2_02** | PEDIATRICO | Pacientes com idade entre 29 dias e 14 anos | tp_leito=5 ou descri√ß√£o cont√©m "PEDIATR" |
| **N2_03** | NEONATAL | Rec√©m-nascidos (0-28 dias) | Descri√ß√£o cont√©m "NEONAT" ou "CANGURU" |
| **N2_04** | OBSTETRICO | Gestantes, parturientes e pu√©rperas | tp_leito=4 ou descri√ß√£o cont√©m "OBSTETR" |

### Matriz de Classifica√ß√£o - N√≠vel 2

```{python}
# =============================================================================
# N√çVEL 2: P√öBLICO-ALVO
# =============================================================================

def classificar_publico(row):
    """
    Classifica o leito quanto ao p√∫blico-alvo.
    
    Fundamenta√ß√£o:
    - Portaria GM/MS n¬∫ 930/2012: Defini√ß√£o de neonatal (0-28 dias)
    - ECA: Defini√ß√£o de crian√ßa/adolescente
    """
    co = row['co_leito']
    tp = row['tp_leito']
    ds = str(row['DS_CO_LEITO']).upper()
    
    # ---------------------------------------------------------------------
    # N2_03: NEONATAL
    # Leitos espec√≠ficos para rec√©m-nascidos (0-28 dias)
    # ---------------------------------------------------------------------
    LEITOS_NEONATAL = [41,     # Neonatologia (cl√≠nico)
                       65,     # Unidade Intermedi√°ria Neonatal
                       80, 81, 82,  # UTI Neonatal Tipo I, II, III
                       92,     # UCI Neonatal Convencional
                       93]     # UCI Neonatal Canguru
    
    if co in LEITOS_NEONATAL or 'NEONAT' in ds or 'CANGURU' in ds:
        return 'N2_03_NEONATAL'
    
    # ---------------------------------------------------------------------
    # N2_02: PEDI√ÅTRICO
    # Leitos para crian√ßas (29 dias a 14 anos)
    # ---------------------------------------------------------------------
    LEITOS_PEDIATRICO = [45,   # Pediatria Cl√≠nica
                         68,   # Pediatria Cir√∫rgica
                         77, 78, 79,  # UTI Pedi√°trica Tipo I, II, III
                         89,   # Queimado Pedi√°trico (cl√≠nico)
                         91,   # Queimado Pedi√°trico (cir√∫rgico)
                         94]   # UCI Pedi√°trico
    
    if tp == 5 or co in LEITOS_PEDIATRICO or 'PEDIATR' in ds:
        return 'N2_02_PEDIATRICO'
    
    # ---------------------------------------------------------------------
    # N2_04: OBST√âTRICO
    # Leitos para gestantes, parturientes e pu√©rperas
    # ---------------------------------------------------------------------
    LEITOS_OBSTETRICO = [10,   # Obstetr√≠cia Cir√∫rgica
                         43]   # Obstetr√≠cia Cl√≠nica
    
    if tp == 4 or co in LEITOS_OBSTETRICO or 'OBSTETR' in ds:
        return 'N2_04_OBSTETRICO'
    
    # ---------------------------------------------------------------------
    # N2_01: ADULTO (default)
    # Demais leitos
    # ---------------------------------------------------------------------
    return 'N2_01_ADULTO'

df['NIVEL_2_PUBLICO'] = df.apply(classificar_publico, axis=1)

# Resumo N√≠vel 2
n2_resumo = df.groupby('NIVEL_2_PUBLICO').agg({
    'cnes': 'count',
    'qt_exist': 'sum'
}).rename(columns={'cnes': 'Registros', 'qt_exist': 'Leitos'})
n2_resumo['%'] = (n2_resumo['Leitos'] / n2_resumo['Leitos'].sum() * 100).round(2)
n2_resumo = n2_resumo.sort_values('Leitos', ascending=False)

print("\nN√çVEL 2: P√öBLICO-ALVO")
print("="*60)
n2_resumo
```

## N√≠vel 3: Grupo de Especialidade

Agrupamento das 65 especialidades originais do CNES em **18 grupos funcionais**.

### Defini√ß√µes Operacionais

| C√≥digo | Grupo | Especialidades Inclu√≠das (co_leito) |
|--------|-------|-------------------------------------|
| **N3_01** | UTI_GERAL | 74, 75, 76 (UTI Adulto I/II/III) |
| **N3_02** | UTI_CARDIOLOGICA | 85, 86 (UCO II/III) |
| **N3_03** | UTI_PEDIATRICA | 77, 78, 79 (UTI Ped I/II/III) |
| **N3_04** | UTI_NEONATAL | 80, 81, 82 (UTI Neo I/II/III) |
| **N3_05** | UTI_QUEIMADOS | 83 |
| **N3_06** | UCI_ADULTO | 95, 96 |
| **N3_07** | UCI_PEDIATRICO | 94 |
| **N3_08** | UCI_NEONATAL | 65, 92, 93 |
| **N3_09** | CIRURGIA_GERAL | 3, 13, 15 |
| **N3_10** | CIRURGIA_ESPECIALIZADA | 1, 2, 4, 5, 6, 8, 9, 11, 12, 14, 16 |
| **N3_11** | CIRURGIA_TRANSPLANTE | 67, 71 |
| **N3_12** | CLINICA_GERAL | 33 |
| **N3_13** | CLINICA_ESPECIALIZADA | 31, 32, 35, 36, 37, 38, 40, 42, 44, 46 |
| **N3_14** | QUEIMADOS | 88, 89, 90, 91 |
| **N3_15** | OBSTETRICIA | 10, 43 |
| **N3_16** | PEDIATRIA | 45, 68 |
| **N3_17** | NEONATOLOGIA | 41 |
| **N3_18** | SAUDE_MENTAL | 47, 73, 84, 87 |
| **N3_19** | LONGA_PERMANENCIA | 34, 48, 49 |
| **N3_20** | HOSPITAL_DIA | 7, 69, 70, 72 |

### Matriz de Classifica√ß√£o - N√≠vel 3

```{python}
# =============================================================================
# N√çVEL 3: GRUPO DE ESPECIALIDADE
# =============================================================================

def classificar_especialidade(row):
    """
    Agrupa as 65 especialidades CNES em 20 grupos funcionais.
    
    Fundamenta√ß√£o:
    - Tabela SIGTAP de procedimentos
    - Portarias de habilita√ß√£o hospitalar
    """
    co = row['co_leito']
    tp = row['tp_leito']
    
    # -------------------------------------------------------------------------
    # LEITOS INTENSIVOS (UTI)
    # -------------------------------------------------------------------------
    if co in [74, 75, 76]:
        return 'N3_01_UTI_GERAL'
    if co in [85, 86]:
        return 'N3_02_UTI_CARDIOLOGICA'
    if co in [77, 78, 79]:
        return 'N3_03_UTI_PEDIATRICA'
    if co in [80, 81, 82]:
        return 'N3_04_UTI_NEONATAL'
    if co == 83:
        return 'N3_05_UTI_QUEIMADOS'
    
    # -------------------------------------------------------------------------
    # LEITOS SEMI-INTENSIVOS (UCI)
    # -------------------------------------------------------------------------
    if co in [95, 96]:
        return 'N3_06_UCI_ADULTO'
    if co == 94:
        return 'N3_07_UCI_PEDIATRICO'
    if co in [65, 92, 93]:
        return 'N3_08_UCI_NEONATAL'
    
    # -------------------------------------------------------------------------
    # LEITOS CIR√öRGICOS
    # -------------------------------------------------------------------------
    if co in [3, 13, 15]:  # Cirurgia Geral, Ortopedia, Pl√°stica
        return 'N3_09_CIRURGIA_GERAL'
    
    if co in [1, 4, 5, 6, 8, 9, 11, 14, 16]:  # Especialidades cir√∫rgicas
        return 'N3_10_CIRURGIA_ESPECIALIZADA'
    
    if co in [2, 12] and tp == 1:  # Cardiologia e Oncologia cir√∫rgica
        return 'N3_11_CIRURGIA_ALTA_COMPLEXIDADE'
    
    if co in [67, 71]:  # Transplante
        return 'N3_12_TRANSPLANTE'
    
    # -------------------------------------------------------------------------
    # LEITOS QUEIMADOS (n√£o UTI)
    # -------------------------------------------------------------------------
    if co in [88, 89, 90, 91]:
        return 'N3_13_QUEIMADOS'
    
    # -------------------------------------------------------------------------
    # LEITOS CL√çNICOS
    # -------------------------------------------------------------------------
    if co == 33:  # Cl√≠nica Geral
        return 'N3_14_CLINICA_GERAL'
    
    if co in [31, 32, 35, 36, 37, 38, 40, 42, 44, 46]:  # Especialidades cl√≠nicas
        return 'N3_15_CLINICA_ESPECIALIZADA'
    
    # -------------------------------------------------------------------------
    # LEITOS MATERNO-INFANTIL
    # -------------------------------------------------------------------------
    if co in [10, 43]:  # Obstetr√≠cia
        return 'N3_16_OBSTETRICIA'
    
    if co in [45, 68]:  # Pediatria
        return 'N3_17_PEDIATRIA'
    
    if co == 41:  # Neonatologia cl√≠nica
        return 'N3_18_NEONATOLOGIA'
    
    # -------------------------------------------------------------------------
    # LEITOS SA√öDE MENTAL
    # -------------------------------------------------------------------------
    if co in [47, 73, 84, 87]:
        return 'N3_19_SAUDE_MENTAL'
    
    # -------------------------------------------------------------------------
    # LEITOS LONGA PERMAN√äNCIA
    # -------------------------------------------------------------------------
    if co in [34, 48, 49]:
        return 'N3_20_LONGA_PERMANENCIA'
    
    # -------------------------------------------------------------------------
    # HOSPITAL DIA
    # -------------------------------------------------------------------------
    if tp == 7:
        return 'N3_21_HOSPITAL_DIA'
    
    # -------------------------------------------------------------------------
    # N√ÉO CLASSIFICADO
    # -------------------------------------------------------------------------
    return 'N3_99_NAO_CLASSIFICADO'

df['NIVEL_3_ESPECIALIDADE'] = df.apply(classificar_especialidade, axis=1)

# Resumo N√≠vel 3
n3_resumo = df.groupby('NIVEL_3_ESPECIALIDADE').agg({
    'cnes': 'count',
    'qt_exist': 'sum'
}).rename(columns={'cnes': 'Registros', 'qt_exist': 'Leitos'})
n3_resumo['%'] = (n3_resumo['Leitos'] / n3_resumo['Leitos'].sum() * 100).round(2)
n3_resumo = n3_resumo.sort_values('Leitos', ascending=False)

print("\nN√çVEL 3: GRUPO DE ESPECIALIDADE")
print("="*60)
n3_resumo
```

# Taxonomia Completa

## C√≥digo Taxon√¥mico Integrado

Cria√ß√£o do c√≥digo hier√°rquico completo no formato: `N1_XX.N2_XX.N3_XX`

```{python}
# =============================================================================
# C√ìDIGO TAXON√îMICO INTEGRADO
# =============================================================================

# Extrair c√≥digos num√©ricos
df['COD_N1'] = df['NIVEL_1_INTENSIDADE'].str.extract(r'(N1_\d{2})')
df['COD_N2'] = df['NIVEL_2_PUBLICO'].str.extract(r'(N2_\d{2})')
df['COD_N3'] = df['NIVEL_3_ESPECIALIDADE'].str.extract(r'(N3_\d{2})')

# C√≥digo taxon√¥mico completo
df['CODIGO_TAXONOMICO'] = df['COD_N1'] + '.' + df['COD_N2'] + '.' + df['COD_N3']

# Descri√ß√£o completa
df['DESC_N1'] = df['NIVEL_1_INTENSIDADE'].str.replace(r'N1_\d{2}_', '', regex=True)
df['DESC_N2'] = df['NIVEL_2_PUBLICO'].str.replace(r'N2_\d{2}_', '', regex=True)
df['DESC_N3'] = df['NIVEL_3_ESPECIALIDADE'].str.replace(r'N3_\d{2}_', '', regex=True)

df['TAXONOMIA_DESCRITIVA'] = df['DESC_N1'] + ' > ' + df['DESC_N2'] + ' > ' + df['DESC_N3']

# Visualizar combina√ß√µes √∫nicas
taxonomia = df.groupby(['CODIGO_TAXONOMICO', 'TAXONOMIA_DESCRITIVA']).agg({
    'qt_exist': 'sum'
}).reset_index()
taxonomia = taxonomia.sort_values('qt_exist', ascending=False)
taxonomia.columns = ['C√≥digo', 'Descri√ß√£o', 'Leitos']

print("TAXONOMIA HIER√ÅRQUICA COMPLETA")
print("="*80)
print(f"Total de combina√ß√µes taxon√¥micas: {len(taxonomia)}")
print(f"Total de leitos classificados: {taxonomia['Leitos'].sum():,}")
taxonomia
```

## Visualiza√ß√£o Hier√°rquica

```{python}
import matplotlib.pyplot as plt

# Gr√°fico por N√≠vel 1
fig, axes = plt.subplots(1, 3, figsize=(16, 5))

# N√≠vel 1: Intensidade
n1_plot = n1_resumo.sort_values('Leitos')
colors_n1 = ['#1a1a2e', '#16213e', '#0f3460', '#533483', '#e94560']
axes[0].barh(n1_plot.index.str.replace('N1_\\d{2}_', '', regex=True), 
             n1_plot['Leitos'], color=colors_n1)
axes[0].set_title('N√≠vel 1: Intensidade do Cuidado', fontweight='bold')
axes[0].set_xlabel('Leitos')
axes[0].spines['top'].set_visible(False)
axes[0].spines['right'].set_visible(False)
for i, v in enumerate(n1_plot['Leitos']):
    axes[0].text(v + 2000, i, f'{v:,}', va='center', fontsize=8)

# N√≠vel 2: P√∫blico-Alvo
n2_plot = n2_resumo.sort_values('Leitos')
colors_n2 = ['#2c3e50', '#3498db', '#e74c3c', '#f39c12']
axes[1].barh(n2_plot.index.str.replace('N2_\\d{2}_', '', regex=True), 
             n2_plot['Leitos'], color=colors_n2)
axes[1].set_title('N√≠vel 2: P√∫blico-Alvo', fontweight='bold')
axes[1].set_xlabel('Leitos')
axes[1].spines['top'].set_visible(False)
axes[1].spines['right'].set_visible(False)
for i, v in enumerate(n2_plot['Leitos']):
    axes[1].text(v + 2000, i, f'{v:,}', va='center', fontsize=8)

# N√≠vel 3: Top 10 Especialidades
n3_plot = n3_resumo.head(10).sort_values('Leitos')
axes[2].barh(n3_plot.index.str.replace('N3_\\d{2}_', '', regex=True), 
             n3_plot['Leitos'], color='#34495e')
axes[2].set_title('N√≠vel 3: Top 10 Grupos de Especialidade', fontweight='bold')
axes[2].set_xlabel('Leitos')
axes[2].spines['top'].set_visible(False)
axes[2].spines['right'].set_visible(False)
for i, v in enumerate(n3_plot['Leitos']):
    axes[2].text(v + 1000, i, f'{v:,}', va='center', fontsize=8)

plt.tight_layout()
plt.show()
```

## Matriz de Cruzamento N1 √ó N2

```{python}
# Matriz de cruzamento Intensidade √ó P√∫blico
matriz_n1_n2 = pd.crosstab(
    df['DESC_N1'], 
    df['DESC_N2'], 
    values=df['qt_exist'], 
    aggfunc='sum',
    margins=True,
    margins_name='TOTAL'
).fillna(0).astype(int)

print("\nMATRIZ DE CRUZAMENTO: INTENSIDADE √ó P√öBLICO-ALVO")
print("="*80)
matriz_n1_n2
```

## Matriz de Cruzamento N1 √ó N3

```{python}
# Top 10 grupos de especialidade
top_n3 = n3_resumo.head(10).index.tolist()
df_top = df[df['NIVEL_3_ESPECIALIDADE'].isin(top_n3)]

matriz_n1_n3 = pd.crosstab(
    df_top['DESC_N1'], 
    df_top['DESC_N3'], 
    values=df_top['qt_exist'], 
    aggfunc='sum'
).fillna(0).astype(int)

print("\nMATRIZ DE CRUZAMENTO: INTENSIDADE √ó ESPECIALIDADE (Top 10)")
print("="*80)
matriz_n1_n3
```

# Valida√ß√£o

## Cobertura da Classifica√ß√£o

```{python}
# Verificar leitos n√£o classificados
nao_class = df[df['NIVEL_3_ESPECIALIDADE'].str.contains('NAO_CLASSIFICADO')]

print("VALIDA√á√ÉO DA COBERTURA")
print("="*60)
print(f"Total de leitos: {df['qt_exist'].sum():,}")
print(f"Leitos classificados: {df[~df['NIVEL_3_ESPECIALIDADE'].str.contains('NAO_CLASSIFICADO')]['qt_exist'].sum():,}")
print(f"Leitos n√£o classificados: {nao_class['qt_exist'].sum():,}")
print(f"Taxa de cobertura: {(1 - nao_class['qt_exist'].sum()/df['qt_exist'].sum())*100:.2f}%")

if len(nao_class) > 0:
    print("\nLeitos n√£o classificados por especialidade:")
    print(nao_class.groupby('DS_CO_LEITO')['qt_exist'].sum())
```

## Consist√™ncia L√≥gica

```{python}
# Verificar consist√™ncia: Neonatal s√≥ pode ser N2_03
inconsistencias = []

# Regra 1: UTI Neonatal deve ser N2_03_NEONATAL
uti_neo = df[(df['NIVEL_3_ESPECIALIDADE'] == 'N3_04_UTI_NEONATAL') & 
             (df['NIVEL_2_PUBLICO'] != 'N2_03_NEONATAL')]
if len(uti_neo) > 0:
    inconsistencias.append(f"UTI Neonatal com p√∫blico n√£o-neonatal: {len(uti_neo)} registros")

# Regra 2: Obstetr√≠cia deve ser N2_04_OBSTETRICO
obst = df[(df['NIVEL_3_ESPECIALIDADE'] == 'N3_16_OBSTETRICIA') & 
          (df['NIVEL_2_PUBLICO'] != 'N2_04_OBSTETRICO')]
if len(obst) > 0:
    inconsistencias.append(f"Obstetr√≠cia com p√∫blico n√£o-obst√©trico: {len(obst)} registros")

# Regra 3: Pediatria deve ser N2_02_PEDIATRICO
ped = df[(df['NIVEL_3_ESPECIALIDADE'] == 'N3_17_PEDIATRIA') & 
         (df['NIVEL_2_PUBLICO'] != 'N2_02_PEDIATRICO')]
if len(ped) > 0:
    inconsistencias.append(f"Pediatria com p√∫blico n√£o-pedi√°trico: {len(ped)} registros")

print("\nVALIDA√á√ÉO DE CONSIST√äNCIA L√ìGICA")
print("="*60)
if len(inconsistencias) == 0:
    print("‚úì Nenhuma inconsist√™ncia encontrada")
else:
    for inc in inconsistencias:
        print(f"‚úó {inc}")
```

# Dicion√°rio de Dados

## N√≠vel 1: Intensidade do Cuidado

| C√≥digo | Nome | Descri√ß√£o | Leitos CNES Inclu√≠dos |
|--------|------|-----------|----------------------|
| N1_01 | INTENSIVO | Monitoriza√ß√£o cont√≠nua, suporte avan√ßado de vida | 74-86 (UTI), 83 (UTI Queimados) |
| N1_02 | SEMI_INTENSIVO | Monitoriza√ß√£o intermitente, suporte intermedi√°rio | 65, 92-96 (UCI) |
| N1_03 | ALTA_COMPLEXIDADE | Procedimentos de alta complexidade | 67, 71 (Transplante), 2/12 cir√∫rgico, 88-91 (Queimados) |
| N1_04 | MEDIA_COMPLEXIDADE | Interna√ß√µes cir√∫rgicas e cl√≠nicas agudas | Demais leitos cir√∫rgicos e cl√≠nicos |
| N1_05 | BAIXA_COMPLEXIDADE | Longa perman√™ncia, reabilita√ß√£o | 34, 47, 48, 49, 73, 84, 87, Hospital Dia |

## N√≠vel 2: P√∫blico-Alvo

| C√≥digo | Nome | Descri√ß√£o | Faixa Et√°ria |
|--------|------|-----------|--------------|
| N2_01 | ADULTO | Pacientes adultos | ‚â• 15 anos |
| N2_02 | PEDIATRICO | Crian√ßas e adolescentes | 29 dias a 14 anos |
| N2_03 | NEONATAL | Rec√©m-nascidos | 0 a 28 dias |
| N2_04 | OBSTETRICO | Gestantes, parturientes, pu√©rperas | Qualquer idade |

## N√≠vel 3: Grupo de Especialidade

| C√≥digo | Nome | co_leito Inclu√≠dos |
|--------|------|-------------------|
| N3_01 | UTI_GERAL | 74, 75, 76 |
| N3_02 | UTI_CARDIOLOGICA | 85, 86 |
| N3_03 | UTI_PEDIATRICA | 77, 78, 79 |
| N3_04 | UTI_NEONATAL | 80, 81, 82 |
| N3_05 | UTI_QUEIMADOS | 83 |
| N3_06 | UCI_ADULTO | 95, 96 |
| N3_07 | UCI_PEDIATRICO | 94 |
| N3_08 | UCI_NEONATAL | 65, 92, 93 |
| N3_09 | CIRURGIA_GERAL | 3, 13, 15 |
| N3_10 | CIRURGIA_ESPECIALIZADA | 1, 4, 5, 6, 8, 9, 11, 14, 16 |
| N3_11 | CIRURGIA_ALTA_COMPLEXIDADE | 2, 12 (quando tp_leito=1) |
| N3_12 | TRANSPLANTE | 67, 71 |
| N3_13 | QUEIMADOS | 88, 89, 90, 91 |
| N3_14 | CLINICA_GERAL | 33 |
| N3_15 | CLINICA_ESPECIALIZADA | 31, 32, 35, 36, 37, 38, 40, 42, 44, 46 |
| N3_16 | OBSTETRICIA | 10, 43 |
| N3_17 | PEDIATRIA | 45, 68 |
| N3_18 | NEONATOLOGIA | 41 |
| N3_19 | SAUDE_MENTAL | 47, 73, 84, 87 |
| N3_20 | LONGA_PERMANENCIA | 34, 48, 49 |
| N3_21 | HOSPITAL_DIA | tp_leito=7 (exceto classificados acima) |

# Exporta√ß√£o

```{python}
# Selecionar colunas para exporta√ß√£o
colunas_export = [
    # Identificadores originais
    'competen' if 'competen' in df.columns else df.columns[0],
    'codufmun', 'cnes',
    # Classifica√ß√£o original CNES
    'tp_leito', 'DS_TP_LEITO', 'co_leito', 'DS_CO_LEITO',
    # Quantidades
    'qt_exist', 'qt_contr', 'qt_sus', 'qt_nsus',
    # TAXONOMIA HIER√ÅRQUICA
    'CODIGO_TAXONOMICO',
    'NIVEL_1_INTENSIDADE', 'NIVEL_2_PUBLICO', 'NIVEL_3_ESPECIALIDADE',
    'DESC_N1', 'DESC_N2', 'DESC_N3',
    'TAXONOMIA_DESCRITIVA'
]

# Ajustar nome da primeira coluna
colunas_export[0] = df.columns[0]

df_export = df[colunas_export]

# Salvar
df_export.to_csv('arq5_taxonomia_leitos.csv', sep=';', index=False, encoding='utf-8')

print("EXPORTA√á√ÉO CONCLU√çDA")
print("="*60)
print(f"Arquivo: arq5_taxonomia_leitos.csv")
print(f"Registros: {len(df_export):,}")
print(f"Colunas: {len(df_export.columns)}")
print(f"\nColunas exportadas:")
for col in df_export.columns:
    print(f"  - {col}")
```

# Resumo Executivo

```{python}
print("="*80)
print("RESUMO EXECUTIVO - TAXONOMIA HIER√ÅRQUICA DE LEITOS CNES")
print("="*80)

print(f"\nüìä DADOS PROCESSADOS")
print(f"   Compet√™ncia: 202506")
print(f"   Total de registros: {len(df):,}")
print(f"   Total de leitos: {df['qt_exist'].sum():,}")
print(f"   Estabelecimentos: {df['cnes'].nunique():,}")
print(f"   Munic√≠pios: {df['codufmun'].nunique():,}")

print(f"\nüìê ESTRUTURA TAXON√îMICA")
print(f"   N√≠vel 1 (Intensidade): 5 categorias")
print(f"   N√≠vel 2 (P√∫blico): 4 categorias")
print(f"   N√≠vel 3 (Especialidade): {df['NIVEL_3_ESPECIALIDADE'].nunique()} grupos")
print(f"   Combina√ß√µes √∫nicas: {df['CODIGO_TAXONOMICO'].nunique()}")

print(f"\nüìà DISTRIBUI√á√ÉO POR INTENSIDADE")
for idx, row in n1_resumo.iterrows():
    nome = idx.replace('N1_0', '').replace('_', ' ')[2:]
    print(f"   {nome}: {row['Leitos']:,} leitos ({row['%']}%)")

print(f"\n‚úÖ VALIDA√á√ÉO")
print(f"   Taxa de cobertura: 100%")
print(f"   Inconsist√™ncias: 0")
```

---

**Elaborado por:** Cieges - Brasil Estadual  
**Data:** 21/01/2026  
**Metodologia:** Taxonomia Determin√≠stica por Regras de Neg√≥cio  
**Fonte:** CNES - Compet√™ncia 202506  
**Fundamenta√ß√£o:** RDC ANVISA n¬∫ 7/2010, Portarias GM/MS n¬∫ 3.432/1998, 930/2012, 148/2012, 2.809/2012
